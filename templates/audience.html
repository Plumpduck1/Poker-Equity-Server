<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Poker Equity Calculator - Audience</title>
<style>
body { font-family: monospace; line-height: 1.6; }
.cards img { margin-right: 2px; vertical-align: middle; }
.container { display: flex; gap: 20px; align-items: flex-start; }
.column { display: flex; flex-direction: column; min-width: 150px; }
.player-row { margin-bottom: 10px; display: flex; justify-content: space-between; }
.stage-board { margin-bottom: 10px; }
h3 { margin-bottom: 5px; text-align: center; }
.equity-column { min-width: 150px; }
</style>
</head>
<body>
<h1>Audience View - Poker Equity Calculator</h1>

<div class="container">
    <div class="column" id="players-column"></div>
    <div class="column" id="board-column"></div>
    <div class="column equity-column" id="equity-column"></div>
</div>

<script>
async function updateGame() {
    try {
        const response = await fetch('/game_state');
        const data = await response.json();

        // --- Players & Hands ---
        const playersColumn = document.getElementById('players-column');
        playersColumn.innerHTML = '<h3>Players</h3>';
        for (const player of data.players) {
            const div = document.createElement('div');
            div.className = 'player-row';
            div.innerHTML = `<div style="width:120px;"><strong>${data.positions[player]} (${player})</strong></div>`;
            const cardsSpan = document.createElement('span');
            cardsSpan.className = 'cards';
            data.hands[player].forEach(c => {
                const img = document.createElement('img');
                img.src = `/static/cards/${c}.png`;
                img.width = 50;
                cardsSpan.appendChild(img);
            });
            div.appendChild(cardsSpan);
            playersColumn.appendChild(div);
        }

        // --- Board ---
        const boardColumn = document.getElementById('board-column');
        boardColumn.innerHTML = '<h3>Board</h3>';
        const boardDiv = document.createElement('div');
        boardDiv.className = 'stage-board';
        data.board.forEach(c => {
            const img = document.createElement('img');
            img.src = `/static/cards/${c}.png`;
            img.width = 50;
            boardDiv.appendChild(img);
        });
        boardColumn.appendChild(boardDiv);

        // --- Equities & Hand Descriptions ---
        const equityColumn = document.getElementById('equity-column');
        equityColumn.innerHTML = '<h3>Equities & Hands</h3>';
        for (const player of data.players) {
            const div = document.createElement('div');
            div.className = 'player-row';
            div.innerHTML = `<div style="width:120px;">${player}</div>
                             <div>${Math.round(data.equities[data.players.indexOf(player)])}% â€” ${data.hand_ranks[player]}</div>`;
            equityColumn.appendChild(div);
        }
        const tieDiv = document.createElement('div');
        tieDiv.textContent = `Tie: ${Math.round(data.tie)}%`;
        equityColumn.appendChild(tieDiv);

    } catch (err) {
        console.error('Failed to fetch game state:', err);
    }
}

// Poll every 1.5 seconds
setInterval(updateGame, 1500);
updateGame();
</script>
</body>
</html>
